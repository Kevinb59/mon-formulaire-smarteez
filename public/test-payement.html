<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Commande de Coque Personnalisée</title>
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
  <h1>Commande de Coque Personnalisée</h1>

  <form id="payment-form">
    <label for="first-name">Prénom:</label>
    <input type="text" id="first-name" name="firstName" required><br><br>

    <label for="last-name">Nom:</label>
    <input type="text" id="last-name" name="lastName" required><br><br>

    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required><br><br>

    <label for="phone">Numéro de téléphone:</label>
    <input type="tel" id="phone" name="phone" required><br><br>

    <label for="address">Adresse:</label>
    <input type="text" id="address" name="address" required><br><br>

    <label for="address-2">Complément d'adresse (optionnel):</label>
    <input type="text" id="address-2" name="address2"><br><br>

    <label for="city">Ville:</label>
    <input type="text" id="city" name="city" required><br><br>

    <label for="postal-code">Code Postal:</label>
    <input type="text" id="postal-code" name="postalCode" required><br><br>

    <label for="phone-brand">Marque du téléphone:</label>
    <input type="text" id="phone-brand" name="phoneBrand" required><br><br>

    <label for="phone-model">Modèle du téléphone:</label>
    <input type="text" id="phone-model" name="phoneModel" required><br><br>

    <label for="image-url">Lien de l'image (Cloudinary):</label>
    <input type="url" id="image-url" name="imageUrl" required><br><br>

    <label for="custom-text">Texte personnalisé (optionnel):</label>
    <input type="text" id="custom-text" name="customText"><br><br>

    <label for="quantity">Quantité:</label>
    <input type="number" id="quantity" name="quantity" value="1" required><br><br>

    <button type="button" id="checkout-button">Payer maintenant</button>
  </form>

  <script>
    const stripe = Stripe('pk_live_51Q0pzz03Hgw1RFXSzt25jEyuePM3OKHJXvpIcmZhA0J0ndyLraMJxxYuGVBI4SV3VnAnLtOEoHV5E4i8xxZAKwKC00dGkEtZ1P');

    document.getElementById('checkout-button').addEventListener('click', () => {
      const form = document.getElementById('payment-form');
      const formData = new FormData(form);

      const data = {
        firstName: formData.get('firstName'),
        lastName: formData.get('lastName'),
        email: formData.get('email'),
        phone: formData.get('phone'),
        address: formData.get('address'),
        address2: formData.get('address2'),
        city: formData.get('city'),
        postalCode: formData.get('postalCode'),
        phoneBrand: formData.get('phoneBrand'),
        phoneModel: formData.get('phoneModel'),
        imageUrl: formData.get('imageUrl'),
        customText: formData.get('customText'),
        quantity: formData.get('quantity')
      };

      fetch('/api/create-checkout-session', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      })
      .then(response => response.json())
      .then(session => {
        return stripe.redirectToCheckout({ sessionId: session.id });
      })
      .then(result => {
        if (result.error) {
          alert(result.error.message);
        }
      })
      .catch(error => {
        console.error('Erreur lors de la création de la session Stripe:', error);
      });
    });
  </script>
</body>
</html>
