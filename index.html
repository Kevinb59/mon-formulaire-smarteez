<!DOCTYPE html>
<html lang="fr">
<head>
    <!-- Métadonnées de la page -->
    <meta charset="UTF-8"> <!-- Déclaration du jeu de caractères UTF-8 pour les accents et caractères spéciaux -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Ajustement de la mise en page pour les appareils mobiles -->
    <title>Smarteez - Coque personnalisée</title> <!-- Titre de la page visible dans l'onglet du navigateur -->

    <!-- Styles CSS pour la mise en page -->
    <style>
        body {
            font-family: Arial, sans-serif; /* Police d'écriture */
            background-color: #b7d397; /* Couleur de fond de la page */
            color: #333; /* Couleur du texte */
            padding: 20px; /* Espacement interne de la page */
            margin: 0; /* Suppression des marges par défaut */
        }
        .container {
            max-width: 800px; /* Limite la largeur du contenu à 800px */
            margin: 0 auto; /* Centre le contenu horizontalement */
        }
        .frame {
            background-color: #ffffff; /* Couleur de fond du cadre */
            border-radius: 10px; /* Bords arrondis */
            padding: 30px; /* Espacement interne du cadre */
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1); /* Ombre autour du cadre */
            margin-bottom: 20px; /* Espace sous chaque cadre */
        }
        img {
            display: block; /* Rend l'image un élément de bloc */
            width: 100%; /* L'image occupe toute la largeur du cadre */
            border-radius: 10px 10px 0 0; /* Arrondi uniquement les coins du haut */
            margin-bottom: 20px; /* Espace sous l'image */
        }
        h1 {
            text-align: center; /* Centrage du texte */
            color: #5b287c; /* Couleur du titre */
            font-size: 4em; /* Taille du texte */
        }
        h2 {
            text-align: center; /* Centrage des sous-titres */
            color: #5b287c; /* Couleur du sous-titre */
            font-size: 2em; /* Taille du texte */
            margin: 10px 0; /* Espacement autour du sous-titre */
        }
        label {
            font-weight: bold; /* Met le texte en gras */
            color: #333; /* Couleur du texte du label */
        }
        input, select, textarea, button {
            width: 100%; /* Les champs de saisie occupent toute la largeur */
            padding: 10px; /* Espacement interne */
            margin: 10px 0; /* Espace entre les éléments */
            border-radius: 5px; /* Arrondit les bords */
            border: 1px solid #ccc; /* Bordure grise légère */
        }
        button {
            background-color: #5b287c; /* Couleur de fond du bouton */
            color: white; /* Couleur du texte du bouton */
            border: none; /* Retire les bordures */
            cursor: pointer; /* Change le curseur au survol */
            font-size: 1.1em; /* Taille du texte dans le bouton */
        }
        button:hover {
            background-color: #472362; /* Change la couleur au survol */
        }
    </style>
</head>
<body>

<!-- Conteneur principal pour le formulaire -->
<div class="container">
    <!-- Formulaire de commande -->
    <form id="orderForm" enctype="multipart/form-data" novalidate>
        <!-- Premier cadre pour les informations personnelles -->
        <div class="frame">
            <!-- Image bannière -->
            <img src="https://raw.githubusercontent.com/Kevinb59/mon-formulaire-smarteez/main/smarteez.jpg" alt="Smarteez">
            <h2>Commande de coque personnalisée</h2> <!-- Titre du formulaire -->
            <h2>Expédition sous 72h</h2> <!-- Information sur l'expédition -->

            <!-- Saisie du prénom -->
            <label for="firstName">Prénom :</label>
            <input type="text" id="firstName" name="firstName" placeholder="Votre prénom" required>

            <!-- Saisie du nom -->
            <label for="lastName">Nom :</label>
            <input type="text" id="lastName" name="lastName" placeholder="Votre nom" required>

            <!-- Saisie de l'email -->
            <label for="email">Email :</label>
            <input type="email" id="email" name="email" placeholder="Votre email" required>

            <!-- Saisie du téléphone -->
            <label for="phone">Téléphone :</label>
            <input type="tel" id="phone" name="phone" placeholder="Votre numéro de téléphone" required>

            <!-- Saisie de l'adresse -->
            <label for="address">Adresse :</label>
            <input type="text" id="address" name="address" placeholder="Numéro et rue" required>

            <!-- Saisie du complément d'adresse (optionnel) -->
            <label for="address2">Complément d'adresse :</label>
            <input type="text" id="address2" name="address2" placeholder="Complément d'adresse">

            <!-- Saisie de la ville -->
            <label for="city">Ville :</label>
            <input type="text" id="city" name="city" placeholder="Ville" required>

            <!-- Saisie du code postal -->
            <label for="postalCode">Code Postal :</label>
            <input type="text" id="postalCode" name="postalCode" placeholder="Code Postal" required>
        </div>

        <!-- Deuxième cadre pour les détails de la coque personnalisée -->
        <div class="frame">
            <!-- Marque du téléphone -->
            <label for="phoneBrand">Marque de téléphone :</label>
            <input type="text" id="phoneBrand" name="phoneBrand" placeholder="Marque de votre téléphone" required>

            <!-- Modèle du téléphone -->
            <label for="phoneModel">Modèle de téléphone :</label>
            <input type="text" id="phoneModel" name="phoneModel" placeholder="Modèle de votre téléphone" required>

            <!-- Téléchargement de l'image personnalisée -->
            <label for="file">Téléchargez votre image :</label>
            <input type="file" id="file" name="file" accept="image/*" required>

            <!-- Saisie d'un texte personnalisé (optionnel) -->
            <label for="customText">Texte personnalisé (optionnel) :</label>
            <textarea id="customText" name="customText" placeholder="Texte personnalisé pour votre coque" rows="4"></textarea>
        </div>

        <!-- Troisième cadre pour le bouton de paiement -->
        <div class="frame">
            <button type="button" id="paymentButton">Payer maintenant</button> <!-- Bouton de paiement -->
        </div>
    </form>
</div>

<!-- Script pour gérer le stockage dans le localStorage et le paiement -->
<script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script> <!-- Script Cloudinary pour gérer les images -->
<script>
    const form = document.getElementById('orderForm'); // Récupération du formulaire via son ID
    const paymentButton = document.getElementById('paymentButton'); // Récupération du bouton de paiement

    // Écoute du clic sur le bouton de paiement
    paymentButton.addEventListener('click', async function() {
        // Stockage des informations du formulaire dans le localStorage du navigateur
        localStorage.setItem('firstName', document.getElementById('firstName').value);
        localStorage.setItem('lastName', document.getElementById('lastName').value);
        localStorage.setItem('email', document.getElementById('email').value);
        localStorage.setItem('phone', document.getElementById('phone').value);
        localStorage.setItem('address', document.getElementById('address').value);
        localStorage.setItem('address2', document.getElementById('address2').value);
        localStorage.setItem('city', document.getElementById('city').value);
        localStorage.setItem('postalCode', document.getElementById('postalCode').value);
        localStorage.setItem('phoneBrand', document.getElementById('phoneBrand').value);
        localStorage.setItem('phoneModel', document.getElementById('phoneModel').value);
        localStorage.setItem('customText', document.getElementById('customText').value);

        // Gestion du téléchargement de l'image
        const fileInput = document.getElementById('file'); // Récupération du champ "fichier"
        const file = fileInput.files[0]; // Récupération du fichier sélectionné

        if (file) { // Vérification si un fichier est présent
            const cloudName = 'dwjkmwlyb';  // Nom du cloud Cloudinary
            const uploadPreset = 'smarteez_orders'; // Nom du preset d'upload sur Cloudinary

            const url = `https://api.cloudinary.com/v1_1/${cloudName}/upload`; // URL d'upload vers Cloudinary

            const formData = new FormData(); // Création d'un objet FormData pour envoyer le fichier
            formData.append('file', file); // Ajout du fichier
            formData.append('upload_preset', uploadPreset); // Ajout du preset

            try {
                const response = await fetch(url, {
                    method: 'POST', // Méthode POST pour l'envoi du fichier
                    body: formData // Envoi des données
                });

                const data = await response.json(); // Conversion de la réponse en JSON
                if (data.secure_url) { // Vérification si l'upload a réussi
                    localStorage.setItem('imageUrl', data.secure_url);  // Stocke l'URL de l'image dans le localStorage
                    window.location.href = 'https://buy.stripe.com/9AQ4jS0TBamsbAsfYY';  // Redirige vers la page de paiement Stripe
                } else {
                    console.error("Erreur lors de l'upload : ", data.error); // Affiche l'erreur en cas d'échec
                }
            } catch (error) {
                console.error('Erreur lors de l\'upload vers Cloudinary:', error); // Gère les erreurs de l'upload
            }
        }
    });
</script>

</body>
</html>
