<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Téléphones</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        label, input, select, button {
            display: block;
            margin: 10px 0;
        }
        .brand-container, .model-container {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

    <h1>Gestion des Marques et Modèles de Téléphone</h1>
    
    <div id="phone-management">
        <!-- Formulaire pour ajouter une marque -->
        <div class="brand-container">
            <label for="newBrandInput">Ajouter une nouvelle marque :</label>
            <input type="text" id="newBrandInput" placeholder="Nouvelle marque">
            <button id="addBrandBtn">Ajouter une marque</button>
        </div>

        <!-- Formulaire pour ajouter un modèle -->
        <div class="model-container">
            <label for="brandSelect">Marque :</label>
            <select id="brandSelect">
                <option value="">Sélectionner une marque</option>
                <!-- Rempli dynamiquement avec les marques existantes -->
            </select>

            <label for="modelInput">Modèle :</label>
            <input type="text" id="modelInput" placeholder="Ajouter un nouveau modèle">
            <button id="addModelBtn">Ajouter un modèle</button>
        </div>

        <button id="saveChangesBtn">Sauvegarder les modifications</button>

        <!-- Section pour visualiser les marques et modèles -->
        <div class="existing-data">
            <h2>Liste des Marques et Modèles</h2>
            <ul id="phoneList"></ul>
        </div>

        <!-- Bouton pour supprimer une marque ou un modèle -->
        <button id="deleteBtn">Supprimer une marque ou un modèle</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAOj_aM10Fcmy7EoVRdgAqXrMBQ1gt081o",
            authDomain: "smart-z-phone-management.firebaseapp.com",
            projectId: "smart-z-phone-management",
            storageBucket: "smart-z-phone-management.appspot.com",
            messagingSenderId: "949078314626",
            appId: "1:949078314626:web:a2a5cb9d87774dc70251b",
            measurementId: "G-KV5WM5J2EX"
        };

        // Initialiser Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let phonesData = { brands: {} }; // Par défaut vide

        // Fonction pour charger les données existantes de Firestore
        async function loadPhonesData() {
            try {
                const docRef = doc(db, 'phones', 'phonesData');
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    phonesData = docSnap.data();
                    console.log("Données récupérées avec succès :", phonesData);
                    updateBrandSelect();
                    displayPhoneList();
                } else {
                    console.log('Aucune donnée trouvée');
                }
            } catch (error) {
                console.error("Erreur lors du chargement des données :", error);
            }
        }

        // Mettre à jour la sélection de marque
        function updateBrandSelect() {
            const brandSelect = document.getElementById('brandSelect');
            brandSelect.innerHTML = '<option value="">Sélectionner une marque</option>';
            
            if (phonesData && phonesData.brands) {
                Object.keys(phonesData.brands).forEach(brand => {
                    const option = document.createElement('option');
                    option.value = brand;
                    option.textContent = brand;
                    brandSelect.appendChild(option);
                });
            } else {
                console.error("Aucune marque trouvée dans les données.");
            }
        }

        // Afficher la liste des marques et modèles
        function displayPhoneList() {
            const phoneList = document.getElementById('phoneList');
            phoneList.innerHTML = '';
            
            if (phonesData && phonesData.brands) {
                Object.entries(phonesData.brands).forEach(([brand, models]) => {
                    const li = document.createElement('li');
                    li.textContent = `${brand}: ${models.join(', ')}`;
                    phoneList.appendChild(li);
                });
            }
        }

        // Ajouter une marque
        document.getElementById('addBrandBtn').addEventListener('click', function() {
            const newBrand = document.getElementById('newBrandInput').value;
            if (newBrand && !phonesData.brands[newBrand]) {
                phonesData.brands[newBrand] = [];
                updateBrandSelect();
                displayPhoneList();
                alert('Marque ajoutée avec succès.');
            } else {
                alert('La marque existe déjà ou est invalide.');
            }
        });

        // Ajouter un modèle à la marque sélectionnée
        document.getElementById('addModelBtn').addEventListener('click', function() {
            const selectedBrand = document.getElementById('brandSelect').value;
            const newModel = document.getElementById('modelInput').value;

            if (selectedBrand && newModel) {
                if (!phonesData.brands[selectedBrand].includes(newModel)) {
                    phonesData.brands[selectedBrand].push(newModel);
                    displayPhoneList();
                    alert('Modèle ajouté avec succès.');
                } else {
                    alert('Ce modèle existe déjà.');
                }
            } else {
                alert('Veuillez sélectionner une marque et entrer un modèle.');
            }
        });

        // Supprimer une marque ou un modèle avec confirmation
        document.getElementById('deleteBtn').addEventListener('click', function() {
            const selectedBrand = document.getElementById('brandSelect').value;
            const newModel = document.getElementById('modelInput').value;

            if (selectedBrand && !newModel) {
                if (confirm(`Voulez-vous vraiment supprimer la marque ${selectedBrand} et tous ses modèles ?`)) {
                    delete phonesData.brands[selectedBrand];
                    updateBrandSelect();
                    displayPhoneList();
                    alert('Marque supprimée avec succès.');
                }
            } else if (selectedBrand && newModel && phonesData.brands[selectedBrand].includes(newModel)) {
                if (confirm(`Voulez-vous vraiment supprimer le modèle ${newModel} de la marque ${selectedBrand} ?`)) {
                    phonesData.brands[selectedBrand] = phonesData.brands[selectedBrand].filter(model => model !== newModel);
                    displayPhoneList();
                    alert('Modèle supprimé avec succès.');
                }
            } else {
                alert('Veuillez sélectionner une marque ou un modèle valide.');
            }
        });

        // Sauvegarder les modifications dans Firestore
        document.getElementById('saveChangesBtn').addEventListener('click', function() {
            savePhoneData(phonesData);
        });

        // Fonction pour sauvegarder les données dans Firestore
        async function savePhoneData(data) {
            try {
                await setDoc(doc(db, 'phones', 'phonesData'), data);
                alert('Données sauvegardées avec succès.');
            } catch (error) {
                console.error('Erreur lors de la sauvegarde des données :', error);
                alert('Erreur lors de la sauvegarde des données.');
            }
        }

        // Charger les données au démarrage
        loadPhonesData();
    </script>

</body>
</html>
