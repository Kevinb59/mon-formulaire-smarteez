<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Téléphones</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        label, input, select, button {
            display: block;
            margin: 10px 0;
        }
        .brand-container {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

    <h1>Gestion des Marques et Modèles de Téléphone</h1>
    
    <div id="phone-management">
        <!-- Formulaire pour ajouter/modifier des téléphones -->
        <div class="brand-container">
            <label for="brandSelect">Marque :</label>
            <select id="brandSelect">
                <!-- Rempli dynamiquement avec les marques existantes -->
            </select>
        </div>

        <div class="model-container">
            <label for="modelInput">Modèle :</label>
            <input type="text" id="modelInput" placeholder="Ajouter un nouveau modèle">
        </div>

        <button id="addModelBtn">Ajouter un modèle</button>
        <button id="saveChangesBtn">Sauvegarder les modifications</button>
    </div>

    <script>
        // URL brute de phones.json
        const jsonUrl = '/phones.json';

        let phonesData = {};

        // Charger les données JSON existantes
        fetch(jsonUrl)
            .then(response => response.json())
            .then(data => {
                phonesData = data;
                const brandSelect = document.getElementById('brandSelect');

                // Remplir la liste des marques
                Object.keys(phonesData.brands).forEach(brand => {
                    const option = document.createElement('option');
                    option.value = brand;
                    option.textContent = brand;
                    brandSelect.appendChild(option);
                });
            });

        // Ajouter un modèle à la marque sélectionnée
        document.getElementById('addModelBtn').addEventListener('click', function() {
            const selectedBrand = document.getElementById('brandSelect').value;
            const newModel = document.getElementById('modelInput').value;

            if (selectedBrand && newModel) {
                if (!phonesData.brands[selectedBrand]) {
                    phonesData.brands[selectedBrand] = [];
                }
                phonesData.brands[selectedBrand].push(newModel);
                alert('Modèle ajouté avec succès.');
            } else {
                alert('Veuillez sélectionner une marque et entrer un modèle.');
            }
        });

        // Sauvegarder les modifications
        document.getElementById('saveChangesBtn').addEventListener('click', function() {
            fetch('/api/update-phones', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(phonesData)
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
            })
            .catch(error => {
                console.error('Erreur lors de la sauvegarde :', error);
                alert('Erreur lors de la sauvegarde.');
            });
        });
    </script>

</body>
</html>
